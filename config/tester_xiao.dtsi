&i2c0 {
    status = "okay";

    mcp0: mcp23017@20 {
        compatible = "microchip,mcp23017";
        reg = <0x20>;        /* MCP23017 I²C address (A0–A2 = GND) */
        gpio-controller;
        #gpio-cells = <2>;
    };
};

/ {
    chosen {
        zmk,kscan = &kscan0;
    };

    kscan0: kscan_matrix {
        compatible = "zmk,kscan-gpio-matrix";
        diode-direction = "row2col";
        wakeup-source;
        /* Rows = MCP23017 pins (0–15 → GPA0..GPA7, GPB0..GPB7) */
        row-gpios = <&mcp0 0 0>, <&mcp0 0 1>, <&mcp0 0 2>, <&mcp0 0 3>,
                    <&mcp0 0 4>, <&mcp0 0 5>, <&mcp0 0 6>, <&mcp0 0 7>,
                    <&mcp0 1 0>, <&mcp0 1 1>, <&mcp0 1 2>, <&mcp0 1 3>,
                    <&mcp0 1 4>, <&mcp0 1 5>, <&mcp0 1 6>, <&mcp0 1 7>;


        /* Cols = GPIOs from the XIAO (replace PINx with actual pins used) */
        col-gpios = <&gpio0 2 0>,   /* Column 0 */
                    <&gpio0 3 0>,  /* Column 1 */
                    <&gpio0 28 0>,  /* Column 2 */
                    <&gpio0 29 0>,  /* Column 3 */
                    <&gpio0 11 0>,  /* Column 4 */
                    <&gpio0 12 0>,  /* Column 5 */
                    <&gpio0 13 0>,  /* Column 6 */
                    <&gpio0 14 0>;  /* Column 7 */

        matrix-rows = <16>;
        matrix-columns = <8>;
    };
};
